(executable
 (name index)
 (modes byte)
 (link_flags -linkall)
 (libraries js_of_ocaml-toplevel vdom))

(rule
 (target exports.txt)
 (action
  (run jsoo_listunits -o %{target} stdlib %{lib:vdom.base:vdom_base.cma} %{lib:vdom:vdom_js.cma})))

(rule
 (target editor.js)
 (deps (source_tree editor))
 (action (run make -C editor)))

(rule
 (target index.js)
 (action
  (run js_of_ocaml --export %{dep:exports.txt} --toplevel --pretty %{dep:index.bc} -o %{target})))

(alias
 (name default)
 (deps index.css index.js index.html editor.js))
